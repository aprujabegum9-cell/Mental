<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js"></script>
</head>
<body style="text-align: center; padding: 50px; font-family: Arial;">
    <h1>Admin Panel</h1>
    <button id="enable-btn" style="padding: 15px 30px; background: red; color: white; border-radius: 20px; border:none; cursor:pointer;">
        Enable Notifications
    </button>
    <p id="status" style="margin-top: 20px; color: blue;">‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...</p>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD_TytbX1kd4SKQ5uHZfd5XVGwdw0gzUOE",
            authDomain: "feeling-hungry-102a9.firebaseapp.com",
            databaseURL: "https://feeling-hungry-102a9-default-rtdb.firebaseio.com",
            projectId: "feeling-hungry-102a9",
            storageBucket: "feeling-hungry-102a9.firebasestorage.app",
            messagingSenderId: "736201265500",
            appId: "1:736201265500:web:7b7064b314247c02ad7199"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const messaging = firebase.messaging();

        messaging.onMessage((payload) => {
            console.log('Message received: ', payload);
            alert("üîî " + payload.notification.title + "\n" + payload.notification.body);
        });

        document.getElementById('enable-btn').onclick = async () => {
            const status = document.getElementById('status');
            status.innerText = "‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            
            try {
                // ‡ßß. ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ö‡ßá‡¶ï
                const permission = await Notification.requestPermission();
                if (permission !== 'granted') {
                    status.innerText = "‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá‡•§ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
                    alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® Allow ‡¶ï‡¶∞‡ßÅ‡¶®!");
                    return;
                }

                // ‡ß®. ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞
                status.innerText = "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï‡¶æ‡¶∞ ‡¶∞‡ßá‡¶°‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
                // ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶π‡ßã‡¶® sw.js ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶Ü‡¶õ‡ßá
                const registration = await navigator.serviceWorker.register('./sw.js');
                const readyRegistration = await navigator.serviceWorker.ready;

                // ‡ß©. ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                status.innerText = "‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
                const token = await messaging.getToken({ 
                    vapidKey: 'BKcBJ89J4OzUj91NIIM8qNlnV0mEf7WC0x7ELLmpkCJeFN5WHkda1c7RL1yDmWfGLqQZIeBt2x5QaskbU5PDe2U',
                    serviceWorkerRegistration: readyRegistration 
                });

                if (token) {
                    status.innerText = "‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
                    await db.ref('admin_tokens/admin_1').set({ 
                        token: token, 
                        updated_at: Date.now() 
                    });
                    
                    status.innerHTML = "<b style='color:green;'>‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!</b>";
                    alert("‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶è‡¶ñ‡¶® ‡¶ö‡¶æ‡¶≤‡ßÅ‡•§");
                } else {
                    status.innerText = "‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§";
                }

            } catch (err) {
                console.error(err);
                status.innerHTML = "<b style='color:red;'>‡¶≠‡ßÅ‡¶≤: " + err.message + "</b>";
            }
        };
    </script>
</body>
</html>